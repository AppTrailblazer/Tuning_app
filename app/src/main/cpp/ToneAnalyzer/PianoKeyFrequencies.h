#ifndef PIANOMETER_ANDROID_PIANOKEYFREQUENCIES_H
#define PIANOMETER_ANDROID_PIANOKEYFREQUENCIES_H

#include "ToneDetectorConstants.h"

#define STANDARD_FREQUENCY 440.0

class PianoKeyFrequencies {
public:
    PianoKeyFrequencies();

    void setOffsetFactor(double factor);

    double getOffsetFactor();

    double frequency(int noteZeroIndexed);

    double frequencyP12(int noteZeroIndexed);

    double targetFrequency(int partial, int noteZeroIndexed);

    int closestKey(double freq);

    int closestKeyP12(double freq);

    void computeTargetFrequencies(const double* delta, const double* Bave);

private:
    double pitchOffsetFactor = 1.0;
    double standardFrequency = STANDARD_FREQUENCY;
    double PIANO_KEY_FREQUENCIES[NOTES_ON_PIANO];
    double PIANO_KEY_FREQUENCIES_P12[NOTES_ON_PIANO];

    double targetFreq[10][NOTES_ON_PIANO] = {
            {26.817194,   28.47907728, 30.24817303, 32.11565324, 34.07830125, 36.17144651, 38.37759219, 40.72460724, 43.20547606, 45.81706333, 48.59216378, 51.50995365, 54.61759553, 57.89569008, 61.37750536, 65.0719369,  68.95834557, 73.09684749, 77.4543366,  82.09851642, 87.0098694,  92.19884335, 97.71640717, 103.5222182, 109.7126246, 116.2393193, 123.1783993, 130.5412541, 138.2926427, 146.5500976, 155.2429081, 164.5214038, 174.3267944, 184.6990714, 195.731536,  207.3400669, 219.7193562, 232.7633356, 246.658635,  261.4025188, 276.9163927, 293.4398259, 310.8428953, 329.4165078, 349.0299052, 369.8159012, 391.9215654, 415.1819721, 440,         466.0941449, 494.011717,  523.5471801, 554.6837032, 587.8284933, 622.7307047, 659.967422,  699.2395041, 740.9907181, 785.5159129, 832.1879547, 881.9305828, 934.367085,  990.3769511, 1049.446636, 1112.015226, 1178.603002, 1248.864058, 1323.822138, 1402.869175, 1487.49922,  1577.255405, 1671.686741, 1772.231755, 1878.225233, 1991.436036, 2110.994856, 2237.508475, 2373.019867, 2515.209968, 2667.165646, 2827.630067, 2999.173471, 3180.08806, 3372.407728, 3577.31864, 3794.667408, 4027.138696, 4273.074848},
            {53.68574194, 57.00738639, 60.54358006, 64.2766423,  68.20013117, 72.38474558, 76.79546313, 81.48804706, 86.44845399, 91.67040996, 97.21953076, 103.0541542, 109.2686402, 115.8241812, 122.7873391, 130.1759175, 137.94864,   146.2257828, 154.9411374, 164.2301626, 174.0538427, 184.4331113, 195.469966,  207.0837536, 219.467263,  232.5239275, 246.4060481, 261.1364998, 276.644891,  293.1664606, 310.559899,  329.1261038, 348.7476623, 369.5048035, 391.5844465, 414.8186015, 439.597133,  465.7082422, 493.5258063, 523.0449145, 554.1089422, 587.1979973, 622.0529567, 659.2569655, 698.5495131, 740.1977346, 784.4975541, 831.1206373, 880.8755306, 933.2010906, 989.1958891, 1048.45169,  1110.938477, 1177.476106, 1247.567139, 1322.373443, 1401.302442, 1485.251158, 1574.819808, 1668.761557, 1768.940504, 1874.615138, 1987.566074, 2106.781727, 2233.164835, 2367.785401, 2509.977636, 2661.832484, 2822.166555, 2994.030394, 3176.558271, 3368.901374, 3574.026943, 3790.673944, 4022.504405, 4267.871312, 4528.12273, 4807.537295, 5101.583813, 5416.708866, 5750.582563, 6108.684169, 6487.830653, 6892.500377, 7325.508235, 7786.98951, 8282.970533, 8810.641381},
            {80.65683425, 85.63401764, 90.9333324,  96.52819657, 102.4089259, 108.6816692, 115.2938212, 122.3290904, 129.7663815, 137.5962753, 145.9172617, 154.6668106, 163.9865491, 173.8182434, 184.2618011, 195.343959,  207.0028076, 219.4188703, 232.4928437, 246.4280459, 261.1660015, 276.738206,  293.2978048, 310.7238984, 329.3059019, 348.8990841, 369.7321631, 391.8396912, 415.1163078, 439.9153042, 466.0249966, 493.8973261, 523.356593,  554.5237545, 587.6799807, 622.5739178, 659.7915609, 699.0160549, 740.8097564, 785.1666979, 831.8533467, 881.592285,  933.9966285, 989.9444155, 1049.047383, 1111.709992, 1178.380572, 1248.570396, 1323.499227, 1402.329981, 1486.720348, 1576.065016, 1670.328003, 1770.752615, 1876.603218, 1989.641719, 2108.993347, 2236.027137, 2371.669417, 2514.068201, 2666.060717, 2826.563947, 2998.302156, 3179.795883, 3372.459511, 3577.970192, 3795.392587, 4027.969369, 4274.004626, 4538.226425, 4819.451785, 5116.535,    5434.144882, 5770.554851, 6131.556723, 6514.895544, 6922.911966, 7362.481897, 7827.050952, 8326.933461, 8859.053109, 9432.418092, 10042.77245, 10697.77362, 11402.64424, 12158.56582, 12976.05156, 13851.96301},
            {107.7813366, 114.40778,   121.4642973, 128.9153335, 136.7479375, 145.1038287, 153.9127347, 163.2863854, 173.1965981, 183.6307995, 194.7204326, 206.3820561, 218.8046692, 231.910585,  245.8331349, 260.6080266, 276.1527234, 292.7081276, 310.141852,  328.7252295, 348.380383,  369.1494839, 391.2370047, 414.4818953, 439.2704749, 465.4099899, 493.2058957, 522.7047083, 553.7663705, 586.8627443, 621.7121073, 658.9181563, 698.2474066, 739.8622776, 784.1391375, 830.7440223, 880.460491,  932.8676385, 988.7181429, 1048.006649, 1110.424391, 1176.939315, 1247.038918, 1321.900093, 1401.0098,   1484.914299, 1574.219612, 1668.281091, 1768.737971, 1874.482699, 1987.743756, 2107.727058, 2234.401332, 2369.449308, 2511.909505, 2664.166399, 2825.079483, 2996.517385, 3179.762977, 3372.380166, 3578.227319, 3795.913582, 4029.168854, 4276.089042, 4538.669457, 4819.277104, 5116.778566, 5435.689472, 5773.889351, 6137.956387, 6526.517739, 6938.26992,  7379.825639, 7849.169208, 8354.550538, 8893.33214,  9469.185912, 10092.07641, 10753.65762, 11468.79477, 12234.07216, 13062.84001, 13950.25044, 14908.07365, 15944.90717, 17063.8819, 18281.40772, 19594.92885},
            {135.1096328, 143.3770647, 152.1829795, 161.4827555, 171.2601437, 181.6925966, 192.6920627, 204.3983968, 216.7762823, 229.80998,   243.663993,  258.233911,  273.7562457, 290.133822,  307.5334992, 326.0000064, 345.4301886, 366.1255019, 387.9204905, 411.1547096, 435.7309578, 461.7022341, 489.3245765, 518.3969125, 549.4028352, 582.1017578, 616.876299,  653.78532,   692.6544286, 734.0747474, 777.6949616, 824.2714706, 873.5136712, 925.6264202, 981.082542,  1039.466462, 1101.761207, 1167.443156, 1237.45775,  1311.802458, 1390.095498, 1473.554005, 1561.54269,  1655.54254,  1754.919665, 1860.368021, 1972.658298, 2090.995803, 2217.450117, 2350.650377, 2493.411208, 2644.760599, 2804.685922, 2975.330232, 3155.522214, 3348.298303, 3552.273491, 3769.851778, 4002.711922, 4247.860412, 4510.238749, 4788.190896, 5086.531879, 5402.987148, 5740.220656, 6101.393609, 6485.262963, 6897.769516, 7336.475091, 7810.023212, 8317.004588, 8856.123604, 9436.232577, 10055.23211, 10724.22605, 11440.45026, 12209.30145, 13044.4113, 13935.87681, 14903.91038, 15945.18507, 17078.3152, 18298.34193, 19622.1722, 21062.81158, 22626.26025, 24336.33044, 26191.89878},
            {162.6914743, 172.5897136, 183.1354058, 194.2747491, 205.9881602, 218.489029,  231.671388,  245.703347,  260.542399,  276.1696257, 292.7827246, 310.2562457, 328.8743888, 348.5204478, 369.3949402, 391.5516809, 414.8669069, 439.7028477, 465.8609979, 493.7493944, 523.251608,  554.4316553, 587.5974376, 622.5080194, 659.7447294, 699.0193839, 740.7922959, 785.1351474, 831.8396618, 881.6170823, 934.0470564, 990.0398664, 1049.24862,  1111.921823, 1178.630324, 1248.878177, 1323.850243, 1402.921838, 1487.234203, 1576.790373, 1671.138286, 1771.749017, 1877.867983, 1991.286752, 2111.255415, 2238.622915, 2374.333196, 2517.448725, 2670.48283,  2831.810058, 3004.850053, 3188.466072, 3382.681094, 3590.12401,  3809.432987, 4044.332174, 4293.217502, 4559.07157,  4844.016321, 5144.532136, 5466.718109, 5808.703022, 6176.481719, 6567.471833, 6985.1088,   7433.469933, 7911.303389, 8426.152006, 8975.379015, 9569.941567, 10208.56337, 10890.13727, 11626.08834, 12414.45163, 13269.62557, 14188.98363, 15180.06783, 16260.80609, 17419.94695, 18683.91009, 20049.86613, 21542.66465, 23157.67099, 24917.97622, 26842.02533, 28939.56304, 31243.32243, 33754.35375},
            {190.5758371, 202.0928941, 214.3670161, 227.3350894, 240.9741565, 255.5337924, 270.8899519, 287.2391581, 304.5316484, 322.7453115, 342.1112011, 362.4827444, 384.1920409, 407.1028033, 431.4493646, 457.2947024, 484.4944601, 513.4719032, 543.9955006, 576.5420816, 610.9761056, 647.3728343, 686.0923889, 726.8541625, 770.337772,  816.2077191, 865.0026471, 916.8076277, 971.3810383, 1029.555271, 1090.841598, 1156.305595, 1225.545068, 1298.853623, 1376.901996, 1459.115349, 1546.8832,   1639.481764, 1738.251698, 1843.204855, 1953.822149, 2071.834227, 2196.371342, 2329.543341, 2470.489994, 2620.223832, 2779.872196, 2948.363153, 3128.669571, 3318.921566, 3523.165992, 3740.116706, 3969.852002, 4215.516365, 4475.579644, 4754.495249, 5050.469062, 5367.112088, 5707.043673, 6066.252885, 6452.081673, 6862.499241, 7304.787672, 7776.125325, 8280.833703, 8824.041524, 9404.596837, 10031.83989, 10703.06047, 11431.80173, 12217.09704, 13058.21334, 13969.50528, 14949.36066, 16015.93953, 17167.00998, 18412.68693, 19775.84865, 21244.06221, 22850.84679, 24594.2411, 26506.31733, 28583.13981, 30855.0261, 33346.86702, 36072.97137, 39076.50063, 42361.32361},
            {218.8107894, 231.9329817, 245.922559,  260.7069479, 276.259775,  292.8670914, 310.386591,  329.0433968, 348.7804172, 369.5723344, 391.6837488, 414.94687,   439.7419451, 465.9130481, 493.7285124, 523.2605691, 554.3442849, 587.4642687, 622.3559914, 659.5654378, 698.9380912, 740.5607238, 784.8460924, 831.474141,  881.2234186, 933.7114405, 989.5559198, 1048.855979, 1111.337274, 1177.954542, 1248.151446, 1323.150495, 1402.495337, 1486.526356, 1576.016338, 1670.313262, 1771.01457,  1877.299641, 1990.712724, 2111.278248, 2238.413835, 2374.116208, 2517.405186, 2670.717752, 2833.089865, 3005.7075,   3189.892995, 3384.449599, 3592.827764, 3812.924619, 4049.439512, 4300.954126, 4567.624227, 4853.143479, 5155.838071, 5480.93737,  5826.489132, 6196.788244, 6595.011479, 7016.693747, 7470.514207, 7954.34195,  8476.864014, 9035.091486, 9634.355054, 10280.97967, 10974.02582, 11724.83952, 12530.76313, 13408.21464, 14356.71408, 15376.08583, 16483.98434, 17679.36006, 18984.6155,  20398.15426, 21933.08751, 23617.90791, 25439.1228, 27438.25855, 29614.55118, 32008.28574, 34616.5447, 37477.90375, 40624.68157, 44076.52607, 47888.52587, 52067.94633}
    };

    static int closestKey(double freq, const double *keyFrequencies);

    void computeFrequencies();
};


#endif //PIANOMETER_ANDROID_PIANOKEYFREQUENCIES_H
